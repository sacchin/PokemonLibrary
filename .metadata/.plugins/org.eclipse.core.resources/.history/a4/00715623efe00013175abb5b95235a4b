import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.OutputStream;
import java.io.OutputStreamWriter;
import java.io.PrintStream;
import java.io.PrintWriter;
import java.net.MalformedURLException;
import java.net.URL;
import java.net.URLConnection;

import org.json.JSONObject;


public class PGLGetter {

    private static String urlString = "http://3ds.pokemon-gl.com/frontendApi/gbu/getSeasonPokemonDetail";
	public static URLConnection createURLConnection(URL url) throws Exception {
        URLConnection uc = url.openConnection();
        uc.setDoOutput(true);//POST可能にする
        uc.setRequestProperty("Content-Type", "application/x-www-form-urlencoded; charset=UTF-8");
        uc.setRequestProperty("Referer", "http://3ds.pokemon-gl.com/battle/");
        return uc;
	}
	
	
	public static String get(int pockemonNo) throws Exception {
        String s = "";
        try {
            URL url = new URL(urlString);
            URLConnection uc = createURLConnection(url);
            OutputStream os = uc.getOutputStream();//POST用のOutputStreamを取得

                // ヘッダを設定
                String postStr = "languageId=1&" + 
                        "seasonId=3&" + 
                        "battleType=0&" + 
                        "timezone=JST&" + 
                        "pokemonId=" + pockemonNo + "-0&" + 
                        "displayNumberWaza=10&" + 
                        "displayNumberTokusei=3&" + 
                        "displayNumberSeikaku=10&" + 
                        "displayNumberItem=10&";
                PrintStream ps = new PrintStream(os);
                ps.print(postStr);//データをPOSTする
                ps.close();

                
                InputStream is = uc.getInputStream();//POSTした結果を取得
                BufferedReader reader = new BufferedReader(new InputStreamReader(is, "UTF-8"));
                while ((s = reader.readLine()) != null) {
                    System.out.println(s);
                    return s;
                }
                reader.close();
        } catch (MalformedURLException e) {
            System.err.println("Invalid URL format: " + urlString);
            System.exit(-1);
        } catch (IOException e) {
            System.err.println("Can't connect to " + urlString);
            System.exit(-1);
        }
		
		return s;
	}
	public static void main(String[] args) throws Exception {
		PrintWriter outFile = new PrintWriter(new BufferedWriter(new OutputStreamWriter(new FileOutputStream("C:/Users/U-U/Desktop/filename.txt"),"UTF-8")));

		for (int i = 1; i < 2; i++) {
	        outFile.println(get(i));
	        Thread.sleep(1000);
		}
        outFile.close();
	}

}
